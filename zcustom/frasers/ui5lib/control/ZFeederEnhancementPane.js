sap.ui.define(["sap/client/basecontrols/core/CustomPane"],function(e){"use strict";var t=e.extend("zcustom.frasers.ui5lib.control.ZFeederEnhancementPane",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{},events:{}},renderer:function(e,t){jQuery.sap.log.debug(">> renderer","","zCustomPane");if(!t.getVisible()){return}e.write("<div");e.writeControlData(t);e.addClass("sapClientCodSeodFeeder");e.write("</div>")},initializePane:function(){jQuery.sap.log.debug(">> initializePane","","zCustomPane");var e=this;this._initializeControls();this.getModel().attachDataContainerUpdateFinished(function(){e._onDataContainerUpdateFinished()})},aControls:[],fFromUser:false,fToAccount:false,fToVendor:false,fToAgent:false,sUserEmail:"",oCurrentFeeder:null,_getControls:function(e){jQuery.sap.log.debug(">> _getControls","","zCustomPane");var t=this;if(!this.aControls[e]){var o={};o.oFromUser=new sap.ui.commons.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",checked:true,change:function(e){t._onFromUserChange(e.mParameters.checked)}});o.oFromUser.addStyleClass("outlookBox");o.oToAccount=new sap.ui.commons.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",checked:false,change:function(e){t._onToAccountChange(e.mParameters.checked)}});o.oToAccount.addStyleClass("outlookBox");o.oToVendor=new sap.ui.commons.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",checked:true,change:function(e){t._onToVendorChange(e.mParameters.checked)}});o.oToVendor.addStyleClass("outlookBox");o.oToAgent=new sap.ui.commons.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",checked:false,change:function(e){t._onToAgentChange(e.mParameters.checked)}});o.oToAgent.addStyleClass("outlookBox");o.oRecipientLayout=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[o.oToAccount,o.oToVendor,o.oToAgent]});this.aControls.splice(e,0,o)}return this.aControls[e]},_initializeControls:function(){jQuery.sap.log.debug(">> _initializeControls","","zCustomPane");var e=this;this.aControls=[];this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._onRecipientChange();this._onFromUserChange(this.fFromUser)},onBeforeRendering:function(){jQuery.sap.log.debug(">> onBeforeRendering","","zCustomPane")},onAfterRendering:function(){jQuery.sap.log.debug(">> onAfterRendering","","zCustomPane");var e=this;this.aControls=[];this._onDataContainerUpdateFinished();var t=false;var o=0;var n=null;var a=this.getController().getParentController()._oCurrentComponentModel._mNodeNames.CustomPane;for(var r=0;r<a.length;r++){var s=a[r];if(s._a&&s._a.jsTypeName&&s._a.jsTypeName.indexOf("Feeder")>=0){t=true;break}}if(t){var i=0;if(this.oCurrentFeeder){try{i=parseInt(this.oCurrentFeeder.sId.replace("__feeder",""),10)}catch(e){i=0}}else{i=0}var l=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MAX_VALUE;var u=null;for(r=i;r<=l;r++){var h="__feeder"+r;u=sap.ui.getCore().byId(h);if(u){if(u.oReplyLayout){n=u}}else{if(n){break}else{continue}}}if(n&&n.oReplyLayout){n.oReplyLayout.addContent(this._getNewLayout(o));n.addEventDelegate({onAfterRendering:function(t){e.oCurrentFeeder=t.srcControl}});o++;this.oCurrentFeeder=n;if(this.oCurrentFeeder.oOutlookScoped){this.oCurrentFeeder.oOutlookScoped.setChecked(false)}}}if(this.oCurrentFeeder){var c=this.oCurrentFeeder;var g=this.oCurrentFeeder.cancelButtonPress;this.oCurrentFeeder.cancelButtonPress=function(){c.bIsReply=false;g.apply(c)};if(c.oEmailSendButton){c.oEmailSendButton.attachPress(function(){c.bIsReply=false})}}var d=this.getController().getParentController().getDataContainer().getDataObject("/Root/zFeederRelevant/ToList");if(d){d.attachValueChanged(function(){var t=e._getValue("Root/zFeederRelevant/ReplyEmail");var o=e._getValue("/Root/zFeederRelevant/ToList");if(t){if(t!==o){e._onRecipientChange()}}else if(o!==e.sTo){e._onRecipientChange()}})}d=this.getController().getParentController().getDataContainer().getDataObject("/Root/zFeederRelevant/NewToEmail");if(d){d.attachValueChanged(function(){var t=e._getValue("Root/zFeederRelevant/ReplyEmail");var o=e._getValue("/Root/zFeederRelevant/NewToEmail");if(t){if(t!==o){e._onRecipientChange()}}else if(o!==e.sTo){e._onRecipientChange()}})}},_getNewLayout:function(e){jQuery.sap.log.debug(">> _getNewLayout","","zCustomPane");var t=this._getControls(e);var o=null;if(t){o=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[t.oFromUser,t.oRecipientLayout]})}return o},_onDataContainerUpdateFinished:function(){jQuery.sap.log.debug(">> _onDataContainerUpdateFinished","","zCustomPane");this._onRecipientChange();this._onFromUserChange(this.fFromUser)},_onFromUserChange:function(e){jQuery.sap.log.debug(">> _onFromUserChange");try{if(this.fFromUser!==e||!this.sUserEmail){this.fFromUser=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oFromUser.getChecked()!==e){this.aControls[t].oFromUser.setChecked(e)}}if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}else{this._setFromField("")}}}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_onToAccountChange:function(e){jQuery.sap.log.debug(">> _onToAccountChange","","zCustomPane");if(this.fToAccount!==e){this.fToAccount=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAccount.getChecked()!==e){this.aControls[t].oToAccount.setChecked(e)}}this._onRecipientChange()}},_onToVendorChange:function(e){jQuery.sap.log.debug(">> _onToVendorChange","","zCustomPane");if(this.fToVendor!==e){this.fToVendor=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToVendor.getChecked()!==e){this.aControls[t].oToVendor.setChecked(e)}}this._onRecipientChange()}},_onToAgentChange:function(e){jQuery.sap.log.debug(">> _onToAgentChange","","zCustomPane");if(this.fToAgent!==e){this.fToAgent=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAgent.getChecked()!==e){this.aControls[t].oToAgent.setChecked(e)}}this._onRecipientChange()}},_onRecipientChange:function(){jQuery.sap.log.debug(">> _onRecipientChange","","zCustomPane");if(this.oCurrentFeeder){if(this.oCurrentFeeder.bComposeNewEmail||this.oCurrentFeeder.bIsReply){return}}try{var e="; ";var t=this._getValue("/Root/ZAccountEmail");var o=this._getValue("/Root/ZVendorEmail");var n=this._getValue("/Root/ZAgentEmail");this.sTo=this._getValue("/Root/zFeederRelevant/ToList");this.sTo="";if(this.fToAccount&&t){this.sTo=this.sTo.concat(t).concat(e)}if(this.fToVendor&&o){this.sTo=this.sTo.concat(o).concat(e)}if(this.fToAgent&&n){this.sTo=this.sTo.concat(n).concat(e)}this._setValue("/Root/zFeederRelevant/ToList",this.sTo);this._setValue("/Root/zFeederRelevant/NewToEmail",this.sTo)}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_setFromField:function(e){jQuery.sap.log.debug(">> _setFromField","","zCustomPane");try{this._setValue("/Root/zFeederRelevant/SelectedSMAPEmail",e)}catch(e){jQuery.sap.log.debug("Error in _setFromField: "+e.message)}},_getUserEmail:function(){jQuery.sap.log.debug(">> _getUserEmail","","zCustomPane");var e="";try{e=this._getValue("/Root/ZCurrentUserEmail")}catch(e){jQuery.sap.log.debug("Error in _getUserEmail: "+e.message)}return e},_setValue:function(e,t){jQuery.sap.log.debug(">> _setValue","","zCustomPane");var o=this.getController();while(o){var n=o.getDataContainer();if(n&&n.getDataObject(e)){n.getDataObject(e).setValue(t);break}o=o.getParentController()}},_getValue:function(e){jQuery.sap.log.debug(">> _getValue","","zCustomPane");var t="";var o=this.getController();while(o){var n=o.getDataContainer();if(n&&n.getDataObject(e)){t=n.getDataObject(e).getValue();break}o=o.getParentController()}return t}});return t},true);