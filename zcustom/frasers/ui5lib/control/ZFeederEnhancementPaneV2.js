sap.ui.define(["sap/client/basecontrols/core/CustomPane"],function(e){"use strict";var t=e.extend("zcustom.frasers.ui5lib.control.ZFeederEnhancementPaneV2",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{},events:{}},renderer:function(e,t){jQuery.sap.log.debug(">> renderer","","zCustomPane")},initializePane:function(){jQuery.sap.log.debug(">> initializePane","","zCustomPane");var e=this;this._initParameters();if(sap.client.getCurrentApplication().isNewUI()){var t=this._fetchFeederECController(this._feederECName);if(t){this._onChildControllerAdded()}this.getController().getParentController().attachEvent("ChildControllerAdded",this,this._onChildControllerAdded,this)}else{this._initializeControls()}this.getModel().attachDataContainerUpdateFinished(function(){e._onDataContainerUpdateFinished()})},_initParameters:function(){this._feederECName="";this._sToPath="";this._sToPathOutlook="";this._sFromPath="";if(sap.client.getCurrentApplication().isNewUI()){this._feederECName="COD_Interactions_EC";this._sToPath="/Root/Feeder/Email/ToList";this._sToPathOutlook="";this._sFromPath="/Root/Feeder/Email/From";this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._bIsReply=false;this._loadFirstTime=true}else{this._sToPath="/Root/zFeederRelevant/ToList";this._sToPathOutlook="/Root/zFeederRelevant/NewToEmail";this._sFromPath="/Root/zFeederRelevant/SelectedSMAPEmail"}},_onChildControllerAdded:function(e){try{if(e.oSource._aChildController.length>0){var t=e.oSource._aChildController[e.oSource._aChildController.length-1].getEmbeddingContext()._a.embedName;if(t.indexOf(this._feederECName)!==-1){this._fetchFeederECController(t)}}}catch(e){return}},_enhanceInlineResponse:function(){if(this._oInlineResponse&&this._oInlineResponse._inlineResponseLayout){this._oInlineResponse._inlineResponseLayout.addContent(this._getNewLayoutRUI());this._oInlineResponse.invalidate();this._onRecipientChange();if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}}},_onECInterActionFinished:function(e){if(sap.client.getCurrentApplication().isNewUI()){try{var t=e.getSource().getEmbeddingContext()._a.embedName;var o=this.getController().getParentController().getChildController(t);var s=o.getBaseControl().getContent()[0].getContent()}catch(e){return}try{if(!this._oInlineResponse||s&&s instanceof sap.client.cod.seod.RUIResponse.InlineResponse&&this._oInlineResponse.getId()!==s.getId()){if(this._oInlineResponse&&s&&s instanceof sap.client.cod.seod.RUIResponse.InlineResponse&&this._oInlineResponse.getId()!==s.getId()){this._loadFirstTime=true}this._oInlineResponse=s;if(this._loadFirstTime){this._loadFirstTime=false;this._oInlineResponse.getController().getEventProcessor().attachEvent(sap.client.evt.EventProcessor.EVENTS.EVENT_FIRED,this._eventCallback,this);this._oToDataObject=o.getDataContainer().getDataObject(this._sToPath);this._oFromDataObject=o.getDataContainer().getDataObject(this._sFromPath);this._oURIDataObject=o.getDataContainer().getDataObject("/Root/Feeder/Email/EmailURI");if(this._oFromDataObject){this._oFromDataObject.attachValueChanged(function(e){this.sUserEmail=this._getUserEmail();if(this.fFromUser&&e.getParameter("value")!==this.sUserEmail){this._setFromField(this.sUserEmail)}}.bind(this))}if(this._oURIDataObject){this._oURIDataObject.attachValueChanged(function(e){this._composeEmailURI()}.bind(this))}}if(!this._oInlineResponse._inlineResponseLayout){if(this._oInlineResponse._initializeInlineControl.getFormattedValue()==true){this.wait4InlineResponse=true}else{this._oInlineResponse._inlineResponseLayout=new sap.ui.layout.VerticalLayout;this._oInlineResponse._inlineResponseLayout.addStyleClass("ruiResponseInlineResponseLayout")}}if(this._oInlineResponse._inlineResponseLayout){this._enhanceInlineResponse()}}}catch(e){jQuery.sap.log.debug("Error in _onECInterActionFinished: "+e.message)}}},_fetchFeederECController:function(e){try{var t=this.getController().getParentController().getChildController(e);if(t){t.attachEvent("ECInterActionFinished",this,this._onECInterActionFinished,this)}}catch(e){t=undefined}return t},aControls:[],fFromUser:false,fToAccount:false,fToVendor:false,fToAgent:false,sUserEmail:"",oCurrentFeeder:null,newButtonPressed:false,wait4InlineResponse:false,_eventCallback:function(e){switch(e.getParameter("event")){case"InlineResponse_Initialize":if(this.wait4InlineResponse){this._enhanceInlineResponse();this.wait4InlineResponse=false}break;case"CIP_New_Button":case"CIP_NewMail_Outlook":this.newButtonPressed=true;break;case"Reply_To_Latest_Interaction":case"Reply_To_Selected_Interaction":this._bIsReply=true;break;case"Reply_with_outlook":case"ReplyTo_Interaction_with_outlook":this._bIsReply=true;break;case"Forward_Selected_Interaction":break;case"Feeder_ValueChange":if(this.newButtonPressed){this._onRecipientChange();this._composeEmailURI();this.newButtonPressed=false}break}},_getControls:function(e){jQuery.sap.log.debug(">> _getControls","","zCustomPane");var t=this;if(!this.aControls[e]){var o={};o.oFromUser=new sap.ui.commons.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",checked:true,change:function(e){t._onFromUserChange(e.mParameters.checked)}});o.oFromUser.addStyleClass("outlookBox");o.oToAccount=new sap.ui.commons.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",checked:false,change:function(e){t._onToAccountChange(e.mParameters.checked)}});o.oToAccount.addStyleClass("outlookBox");o.oToVendor=new sap.ui.commons.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",checked:true,change:function(e){t._onToVendorChange(e.mParameters.checked)}});o.oToVendor.addStyleClass("outlookBox");o.oToAgent=new sap.ui.commons.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",checked:false,change:function(e){t._onToAgentChange(e.mParameters.checked)}});o.oToAgent.addStyleClass("outlookBox");o.oRecipientLayout=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[o.oToAccount,o.oToVendor,o.oToAgent]});this.aControls.splice(e,0,o)}return this.aControls[e]},_getControlsRUI:function(){jQuery.sap.log.debug(">> _getControlsRUI","","zCustomPane");var e={};e.oFromUser=new sap.m.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",selected:this.fFromUser,select:function(e){this._onFromUserChange(e.getParameter("selected"))}.bind(this)});e.oToAccount=new sap.m.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",selected:this.fToAccount,select:function(e){this._onToAccountChange(e.getParameter("selected"))}.bind(this)});e.oToVendor=new sap.m.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",selected:this.fToVendor,select:function(e){this._onToVendorChange(e.getParameter("selected"))}.bind(this)});e.oToAgent=new sap.m.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",selected:this.fToAgent,select:function(e){this._onToAgentChange(e.getParameter("selected"))}.bind(this)});e.oRecipientLayout=new sap.ui.layout.HorizontalLayout({width:"100%",content:[e.oToAccount,e.oToVendor,e.oToAgent]});return e},_initializeControls:function(){jQuery.sap.log.debug(">> _initializeControls","","zCustomPane");this.aControls=[];this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._onRecipientChange();this._onFromUserChange(this.fFromUser)},onBeforeRendering:function(){jQuery.sap.log.debug(">> onBeforeRendering","","zCustomPane")},onAfterRendering:function(){jQuery.sap.log.debug(">> onAfterRendering","","zCustomPane");var e=this;this.aControls=[];this._onDataContainerUpdateFinished();var t=false;var o=0;var s=null;var n=this.getController().getParentController()._oCurrentComponentModel._mNodeNames.CustomPane;for(var i=0;i<n.length;i++){var a=n[i];if(a._a&&a._a.jsTypeName&&a._a.jsTypeName.indexOf("Feeder")>=0){t=true;break}}if(t){var r=0;if(this.oCurrentFeeder){try{r=parseInt(this.oCurrentFeeder.sId.replace("__feeder",""),10)}catch(e){r=0}}else{r=0}var l=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MAX_VALUE;var h=null;for(i=r;i<=l;i++){var c="__feeder"+i;h=sap.ui.getCore().byId(c);if(h){if(h.oReplyLayout){s=h}}else{if(s){break}else{continue}}}if(s&&s.oReplyLayout){s.oReplyLayout.addContent(this._getNewLayout(o));s.addEventDelegate({onAfterRendering:function(t){e.oCurrentFeeder=t.srcControl}});o++;this.oCurrentFeeder=s;if(this.oCurrentFeeder.oOutlookScoped){this.oCurrentFeeder.oOutlookScoped.setChecked(false)}}}if(this.oCurrentFeeder){var u=this.oCurrentFeeder;var g=this.oCurrentFeeder.cancelButtonPress;this.oCurrentFeeder.cancelButtonPress=function(){u.bIsReply=false;g.apply(u)};if(u.oEmailSendButton){u.oEmailSendButton.attachPress(function(){u.bIsReply=false})}}if(!sap.client.getCurrentApplication().isNewUI()){this._oToDataObject=this.getController().getParentController().getDataContainer().getDataObject(this._sToPath);if(this._oToDataObject){this._oToDataObject.attachValueChanged(function(){var e=this._getValue("/Root/zFeederRelevant/ReplyEmail");var t=this._oToDataObject.getValue();if(e){if(e!==t){this._onRecipientChange()}}else if(t!==this.sTo){this._onRecipientChange()}}.bind(this))}if(this._sToPathOutlook){var d=this.getController().getParentController().getDataContainer().getDataObject(this._sToPathOutlook);if(d){d.attachValueChanged(function(){var e=this._getValue("/Root/zFeederRelevant/ReplyEmail");var t=this._getValue(this._sToPathOutlook);if(e){if(e!==t){this._onRecipientChange()}}else if(t!==this.sTo){this._onRecipientChange()}}.bind(this))}}}},_getNewLayout:function(e){jQuery.sap.log.debug(">> _getNewLayout","","zCustomPane");var t=this._getControls(e);var o=null;if(t){o=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[t.oFromUser,t.oRecipientLayout]})}return o},_getNewLayoutRUI:function(){jQuery.sap.log.debug(">> _getNewLayoutRUI","","zCustomPane");var e=this._getControlsRUI();var t=null;if(e){t=new sap.ui.layout.VerticalLayout({width:"100%",content:[e.oFromUser,e.oRecipientLayout]})}return t},_onDataContainerUpdateFinished:function(){jQuery.sap.log.debug(">> _onDataContainerUpdateFinished","","zCustomPane");this._onRecipientChange();this._onFromUserChange(this.fFromUser)},_onFromUserChange:function(e){jQuery.sap.log.debug(">> _onFromUserChange");try{if(this.fFromUser!==e||!this.sUserEmail){this.fFromUser=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oFromUser.getChecked()!==e){this.aControls[t].oFromUser.setChecked(e)}}if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}else{this._setFromField("")}}}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_onToAccountChange:function(e){jQuery.sap.log.debug(">> _onToAccountChange","","zCustomPane");if(this.fToAccount!==e){this.fToAccount=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAccount.getChecked()!==e){this.aControls[t].oToAccount.setChecked(e)}}this._onRecipientChange()}},_onToVendorChange:function(e){jQuery.sap.log.debug(">> _onToVendorChange","","zCustomPane");if(this.fToVendor!==e){this.fToVendor=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToVendor.getChecked()!==e){this.aControls[t].oToVendor.setChecked(e)}}this._onRecipientChange()}},_onToAgentChange:function(e){jQuery.sap.log.debug(">> _onToAgentChange","","zCustomPane");if(this.fToAgent!==e){this.fToAgent=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAgent.getChecked()!==e){this.aControls[t].oToAgent.setChecked(e)}}this._onRecipientChange()}},_set_sTo:function(){try{var e=", ";var t=this._getValue("/Root/ZAccountEmail");var o=this._getValue("/Root/ZVendorEmail");var s=this._getValue("/Root/ZAgentEmail");if(this._oToDataObject){this.sTo=this._oToDataObject.getValue();this.sTo="";if(this.fToAccount&&t){this.sTo=this.sTo===""?t:this.sTo.concat(e).concat(t)}if(this.fToVendor&&o){this.sTo=this.sTo===""?o:this.sTo.concat(e).concat(o)}if(this.fToAgent&&s){this.sTo=this.sTo===""?s:this.sTo.concat(e).concat(s)}}}catch(e){jQuery.sap.log.debug("Error in _set_sTo: "+e.message)}},_onRecipientChange:function(){jQuery.sap.log.debug(">> _onRecipientChange","","zCustomPane");if(this.oCurrentFeeder){if(this.oCurrentFeeder.bComposeNewEmail||this.oCurrentFeeder.bIsReply){return}}try{if(this._oToDataObject){this._set_sTo();this._oToDataObject.setValue(this.sTo);if(this._sToPathOutlook){this._setValue(this._sToPathOutlook,this.sTo)}}}catch(e){jQuery.sap.log.debug("Error in _onRecipientChange: "+e.message)}},_composeEmailURI:function(){if(!this._bIsReply){try{var e=this._oURIDataObject.getValue();if(e){var t=e.split("mailto:")[1];var o=t.split("?Subject=")[0];var s=t.split("?Subject=")[1];this._set_sTo();if(o!==this.sTo){e="mailto:".concat(this.sTo.concat("?Subject=".concat(s)));this._oURIDataObject.setValue(e)}}}catch(e){}}else{this._bIsReply=false}},_setFromField:function(e){jQuery.sap.log.debug(">> _setFromField","","zCustomPane");try{if(this._oFromDataObject){this._oFromDataObject.setValue(e)}else{this._setValue(this._sFromPath,e)}}catch(e){jQuery.sap.log.debug("Error in _setFromField: "+e.message)}},_getUserEmail:function(){jQuery.sap.log.debug(">> _getUserEmail","","zCustomPane");var e="";try{e=this._getValue("/Root/ZCurrentUserEmail")}catch(e){jQuery.sap.log.debug("Error in _getUserEmail: "+e.message)}return e},_setValue:function(e,t){jQuery.sap.log.debug(">> _setValue","","zCustomPane");var o=this.getController();while(o){var s=o.getDataContainer();if(s&&s.getDataObject(e)){s.getDataObject(e).setValue(t);break}o=o.getParentController()}},_getValue:function(e){jQuery.sap.log.debug(">> _getValue","","zCustomPane");var t="";var o=this.getController();while(o){var s=o.getDataContainer();if(s&&s.getDataObject(e)){t=s.getDataObject(e).getValue();break}o=o.getParentController()}return t}});return t},true);