//@ui5-bundle zcustom/frasers/ui5lib/library-preload.js
sap.ui.predefine("zcustom/frasers/ui5lib/control/ZAttachmentsPane",["sap/client/basecontrols/core/CustomPane","sap/m/MessageToast","sap/m/GenericTile","sap/m/GenericTileScope","sap/ui/unified/FileUploader","sap/client/m/util/ImageResizer","sap/client/m/create/QuickCreateTile","sap/m/ScrollContainer","sap/m/LightBox","sap/m/LightBoxItem","zcustom/frasers/ui5lib/ext/ZThumbnailTile","zcustom/frasers/ui5lib/ext/ZThumbnailTileContent","zcustom/frasers/ui5lib/ext/ZImage"],function(e,t,i,a,n,o,s,r,l,h,d,c,m){"use strict";var g=e.extend("zcustom.frasers.ui5lib.control.ZAttachmentsPane",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{browseTile:{type:"sap.client.m.create.QuickCreateTile",multiple:false},cameraTile:{type:"sap.client.m.create.QuickCreateTile",multiple:false},attachments:{type:"sap.m.GenericTile",multiple:true,singularName:"attachment"},tileContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{}},SMALL_WIDTH_HEIGHT:400,MEDIUM_WIDTH_HEIGHT:600,LARGE_WIDTH_HEIGHT:800,renderer:function(e,t){e.write("<div");e.writeControlData(t);e.addClass("zAttachments");e.writeClasses();e.write(">");e.write("<div style='display : none'>");e.renderControl(t._stdFUoControl);e.write("</div>");e.renderControl(t.getTileContainer());e.write("</div>")},_getCustomParameters:function(){this._primaryPath=this.getParameter("primaryPath")?this.getParameter("primaryPath"):"/Root/AttachmentFolder/AddParams";this._attach2EC=this.getParameter("attach2EC")?this.getParameter("attach2EC"):"COD_Documentlist";this._enableImageProcessor=this.getParameter("enableImageProcessor")?this.getParameter("enableImageProcessor"):"None";this._onFileSelected=this.getParameter("onFileSelected");this._bHideBrowse=this.getParameter("hideBrowse")==="true";this._bHideCamera=this.getParameter("hideCamera")==="true";this._bHideImages=this.getParameter("hideImages")==="true";this._bHideNonImages=this.getParameter("hideNonImages")==="true";this._bMultipleFiles=!(this.getParameter("singleFile")==="true");this._bMultipleFiles=false;this._bAlwaysResize=this.getParameter("alwaysResize")==="true";this._bAlwaysResize=false},_setupThumbnailSize:function(e){var t;if(e){t=$("#"+e).get(0)}if(!t&&(!this._maxThumbnailHeight||!this._maxThumbnailHeight)){t=$("#"+this.getControlPrefixId()+"-browseTile").get(0);if(!t){t=$("#"+this.getControlPrefixId()+"-cameraTile").get(0)}}if(t){if(t.clientWidth&&t.clientHeight){this._maxThumbnailWidth=Math.round(t.clientWidth);this._maxThumbnailHeight=Math.round(t.clientHeight)}else{var i=getComputedStyle(t);if(i){this._maxThumbnailWidth=Math.round(parseFloat(i.width));this._maxThumbnailHeight=Math.round(parseFloat(i.height))}}}},initializePane:function(){this.oController=this.getController();this._oApplication=this._oApplication||this.oController&&this.oController.getApplication&&this.oController.getApplication()||sap.client.getCurrentApplication&&sap.client.getCurrentApplication();if(!this._oApplication.isNewUI()){return}this._oRuntimeEnviroment=this.oController&&this.oController.getRuntimeEnvironment&&this.oController.getRuntimeEnvironment()||this._oApplication.getRuntimeEnvironment();this._getCustomParameters();this.Documents=[];this.Thumbnails=[];this._attachedECController=this._getAttachedECController();if(this._attachedECController){this._onChildControllerAdded();this._DataContainerUpdateFinished()}else{this.oController.getParentController().attachEvent("ChildControllerAdded",this,this._onChildControllerAdded,this)}var e=this._primaryPath;var i=null;var a=this._oRuntimeEnviroment;var s=a.isRunningInContainer();var r=sap.ui.Device.os.ios;var l;var h=this._oApplication.getSettings();if(this._oApplication.isOfflineMode()){l=h.getDefaultImageUploadResolutionClassificationForOffline()}else{l=h.getDefaultImageUploadResolutionClassificationForOnline()}this._setupImageResize(l);var d=this._enableImageProcessor;if(d==="Crop"&&this.oController){var c=a.isRunningOnWindowsContainer();if(!c){jQuery.sap.require("sap.client.basecontrols.core.ImageProcessor");var m=new sap.client.basecontrols.core.ImageProcessor(this,e);this.oController.setImageProcessor(m)}}var g=this._iCompressedWidthHeight&&!this.oController.getImageProcessor();if(g){this.oImageResizer=new o(this._iCompressedWidthHeight,this._iCompressedWidthHeight)}if(false&&(this.oImageResizer||this._oApplication.isOfflineMode())&&window.FilePicker){t.show("new sap.m.Button");this.oFileUploader=new sap.m.Button(this.getControlPrefixId()+"-browseButton",{icon:sap.ui.core.IconPool.getIconURI("open-folder"),press:function(){window.FilePicker.pickOne(function(e){var t="data:"+e.mimeType+";base64,"+e.content;if(this.isImageFile(e)&&this.oImageResizer){this.oImageResizer.resizeImage(t).then(function(t){this._onImageResized(null,t,e.name)}.bind(this),function(i){this._uploadFile(t,e.name)}.bind(this))}else{if(this._oApplication.isOfflineMode()){var i=this._oApplication.getFileTransfer();this._showUploadingDialog();var a={fileKey:"file",fileName:e.name,mimeType:e.type,content:e.content,size:e.size};var n=this.onFileUploadSuccess.bind(this);var o=this.onFileUploadFail.bind(this);i.upload(e.name,null,n,o,a)}else{this._uploadFile(t,e.name)}}}.bind(this))}.bind(this)});this.oFileUploader.addStyleClass("sapClientMButtonFileUploader");i={Visible:"visible",Enabled:"enabled"}}else{this.oFileUploader=new n(this.getControlPrefixId(),{uploadOnChange:false,sameFilenameAllowed:true,buttonOnly:true,sendXHR:true,multiple:this._bMultipleFiles,change:[this._fnFileUploader_Change,this],uploadAborted:function(){this._closeUploadingDialog()}.bind(this),uploadComplete:[this._fnFileUploader_UploadComplete,this],fileSizeExceed:function(e){sap.m.MessageToast.show(sap.client.m.Util.getLocaleText("FileUploadExceedLimitMsg","Exceeds maximum file size of 2MB"))}});this.oFileUploader.setTooltip(sap.client.m.Util.getLocaleText("FileUploader_ToolTip","No file chosen"));i={Visible:"visible",Enabled:"enabled",Text:"buttonText"};if(s&&!r){this.oFileUploader.setIcon(sap.ui.core.IconPool.getIconURI("open-folder"));this.oFileUploader.setIconOnly(true)}}this._stdFUoControl=this.oFileUploader;this._stdFUoControl.addStyleClass("sapClientMFileUpload");this.oTileContainer=(new sap.m.ScrollContainer).addStyleClass("sapUiTinyMargin");this.setTileContainer(this.oTileContainer);this._buildTiles()},_onChildControllerAdded:function(e){if(!this._getAttachedECController()){return}var t=this._attachedECController.getDataContainer();this.fUpdateFinished=$.proxy(this._DataContainerUpdateFinished,this);if(t){t.attachDataContainerUpdateFinished(this.fUpdateFinished)}},destroy:function(){if(!this._getAttachedECController()){return}var e=this._attachedECController.getDataContainer();if(this.fUpdateFinished){if(e){e.detachDataContainerUpdateFinished(this.fUpdateFinished)}this.fUpdateFinished=null}},_fnFileUploader_Change:function(e){var t=e.mParameters;if(t&&!t.newValue){return}if(this.isImageFileUploader(e.oSource)&&this.oImageResizer){var i={mParameters:e.mParameters,oSource:e.oSource};var a=e.mParameters.files[0];this.oImageResizer.resizeImageFile(a).then(function(e){this._onImageResized(i,e)}.bind(this),function(e){this._onFileChange(i)}.bind(this))}else{this._onFileChange(e)}},_fnFileUploader_UploadComplete:function(e){var t=this._primaryPath;this._closeUploadingDialog();if(!this._getAttachedECController()){return}var i=e.mParameters.response||e.mParameters.responseRaw;if(!i){return}i=unescape(decodeURI(i));i=i.replace(/[\r]/g,"");var a=i.split("\n");if(a.length===3){var n=a[0].split("=")[1];var o=a[1].split("=")[1];var s=a[2].split("=")[1];var r=this._attachedECController.getDataContainer();if(sap.ui.Device.os.ios){var l=sap.client.util.Util.createGuid();var h=o.split(".");if(h.length<2){o=o+"-"+l}else{var d=h.pop();var c=h.pop();o=c+"-"+l+"."+d}}r.setProperty(t+"/content","id="+n,this.getBindingContext());r.setProperty(t+"/fileName",o,this.getBindingContext());r.setProperty(t+"/fileSize",s,this.getBindingContext());r.checkUpdate(t+"/fileName.FormattedValue")}var m;if(e&&e.getSource){m=new sap.client.evt.EventContext(e.getSource())}this._onFileSelected=this.___checkAndCreateEH(this._onFileSelected);var g=this._onFileSelected;if(g){this._attachedECController.getEventProcessor().handleEvent(g,m)}},_getAttachedECController:function(){if(!this._attachedECController){if(this.oController&&this.oController.getParentController()&&this.oController.getParentController().getChildController(this._attach2EC)){this._attachedECController=this.oController.getParentController().getChildController(this._attach2EC)}}return this._attachedECController},_DataContainerUpdateFinished:function(){if(!this._getAttachedECController()){return}var e=this._attachedECController.getDataContainer();var t=e.getDataObject("/Root/AttachmentFolder/DocumentList");var i=t.getCount();if(i!==this.Documents.length){this.Documents=[];var a={};var n=[];var o;for(o=0;o<i;o++){n[t.getDataListBindingContext(o).sRowPath]="/Root/AttachmentFolder/DocumentList/"+o}var s;for(s=0;s<i;s++){var r=t.getRow(s);if(r){a={};a.RowIndex=r.getMember("@RowIndex").getValue();a.NodeID=r.getMember("NodeID").getValue();a.FileName=r.getMember("FileName").getValue();a.MimeCode=r.getMember("MimeCode").getValue();a.FileContentURI=this._checkAndAdjustImageURL(r.getMember("FileContentURI").getValue());a.ThumbnailURL=r.getMember("ThumbnailURL").getValue();a.CreatedOn=r.getMember("CreatedOn").getValue();a.ChangedOn=r.getMember("ChangedOn").getValue();a._sNodeId=r.getNodeId();a._sPath=r.getPath();a.DocumentListPath=n[a._sPath];this.Documents.push(a)}}this.Documents.sort(function(e,t){return t.ChangedOn-e.ChangedOn});this._buildTiles()}},_checkAndAdjustImageURL:function(e){var t="";if(e&&e.indexOf("/ap/ds/wd/doc/")===0){try{t=this._oApplication.getHostUrl()+"/sap("+this.oController.getSession().getSessionID()+")"+e}catch(i){t=e}}else{t=e}return t},_buildTiles:function(){if(!this.oTileContainer){return}this.oTileContainer.destroyContent();if(!this.getBrowseTile()){if(!this._bHideBrowse){var e=new sap.client.m.create.QuickCreateTile(this.getControlPrefixId()+"-browseTile",{text:"Browse",icon:"sap-icon://open-folder",press:function(){document.getElementById(this.getControlPrefixId()+"-fu").click()}.bind(this)}).addStyleClass("sapClientMQCTile sapMGT OneByOne sapUshellTile");this.setBrowseTile(e);this.oTileContainer.addContent(e)}}else{this.oTileContainer.addContent(this.getBrowseTile())}if(navigator.camera){if(!this.getCameraTile()){if(!this._bHideCamera){var t=new sap.client.m.create.QuickCreateTile(this.getControlPrefixId()+"-cameraTile",{text:"Camera",icon:"sap-icon://add-photo",press:[this.onPictureButtonPress,this]}).addStyleClass("sapClientMQCTile sapMGT OneByOne sapUshellTile");this.setCameraTile(t);this.oTileContainer.addContent(t)}}else{this.oTileContainer.addContent(this.getCameraTile())}}var i=this.Documents.length;for(var a=0;a<i;a++){var n=this.Documents[a];if(this.isImageMimeCode(n.MimeCode)){if(!this._bHideImages){var o=new sap.m.LightBox;var s=new sap.m.LightBoxItem({imageSrc:n.FileContentURI,title:n.FileName});o.addImageContent(s);var r=this.Thumbnails[n.NodeID];var l=r?r:n.FileContentURI;var h=new m({densityAware:false,src:l});h.setDetailBox(o);h.addCustomData(new sap.ui.core.CustomData({key:"_Document",value:n}));if(!r){h.attachLoad(this._imageOnLoad,this)}var g=new c;g.setContent(h);var p=new d(this.getControlPrefixId()+"-attaimg-"+n.NodeID,{press:[this._tilePressed,this]}).addStyleClass("sapUshellTile");p.addTileContent(g);p._oDocument=n;this.addAttachment(p);this.oTileContainer.addContent(p)}}else{if(!this._bHideNonImages){var u=this._getIconFromFilename(n.FileName);var f=new sap.m.ImageContent({src:u});var C=new sap.m.TileContent;C.setContent(f);var _=new sap.m.GenericTile(this.getControlPrefixId()+"-atta-"+n.NodeID,{header:n.FileName,press:[this._tilePressed,this]}).addStyleClass("sapUshellTile");_.addTileContent(C);_._oDocument=n;this.addAttachment(_);this.oTileContainer.addContent(_)}}}},_convertRemToPixels:function(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)},_imageOnLoad:function(e){var t;try{t=e.getSource().getDomRef().children[1];if(!this._maxThumbnailHeight||!this._maxThumbnailWidth){this._setupThumbnailSize(t.getSource().getParent().getParent().getId());if(!this._maxThumbnailHeight||!this._maxThumbnailWidth){return}}}catch(e){return}var i=t.naturalWidth;var a=t.naturalHeight;var n,o;var s;var r=i>this._maxThumbnailWidth||a>this._maxThumbnailHeight;var l={};l=t;if(r){var h=document.createElement("canvas");h.id="canvasResize";h.width=i;h.height=a;if(i>a){n=Math.round(i*(this._maxThumbnailHeight/a));o=this._maxThumbnailHeight}else{n=this._maxThumbnailWidth;o=Math.round(a*(this._maxThumbnailWidth/i))}h.width=n;h.height=o;var d=h.getContext("2d");d.drawImage(l,0,0,h.width,h.height);i=n;a=o;l=h;s=h.toDataURL("image/jpg",.5)}var c=i>this._maxThumbnailWidth&&a===this._maxThumbnailHeight||a>this._maxThumbnailHeight&&i===this._maxThumbnailWidth;if(c){var m=document.createElement("canvas");h.id="canvasCrop";m.width=i;m.height=a;var g,p;if(i>a){g=Math.round((i-this._maxThumbnailWidth)/2);p=0}else{g=0;p=Math.round((a-this._maxThumbnailHeight)/2)}m.width=this._maxThumbnailWidth;m.height=this._maxThumbnailHeight;var u=m.getContext("2d");u.drawImage(l,g,p,this._maxThumbnailWidth,this._maxThumbnailHeight,0,0,this._maxThumbnailWidth,this._maxThumbnailHeight);s=m.toDataURL("image/jpg",.5)}if(s&&s!==t.src){t.src=s;this.Thumbnails[e.getSource().data("_Document").NodeID]=s}},_isDebugMode:function(){var e=window["sap-ui-debug"];return sap.client.getCurrentApplication().isDebugMode()||e},_getUserMedia:function(e,t,i){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(a){return a.bind(navigator)(e,t,i)}},_grabVideo:function(){if(!navigator.getUserMedia&&!navigator.webkitGetUserMedia&&!navigator.mozGetUserMedia&&!navigator.msGetUserMedia){t.show("User Media API not supported.");return}var e={video:true};this._getUserMedia(e,function(e){var t=document.querySelector("video");if("srcObject"in t){t.srcObject=e;t.src=(window.URL||window.webkitURL).createObjectURL(e)}else if(navigator.mozGetUserMedia){t.mozSrcObject=e}this._theStream=e}.bind(this),function(e){t.show("Error: "+e)}.bind(this)).bind(this)},_takePhoto:function(){if(!("ImageCapture"in window)){t.show("ImageCapture is not available");return}if(!this._theStream){t.show("Grab the video stream first!");return}var e=new ImageCapture(this._theStream.getVideoTracks()[0]);var i=this;e.takePhoto().then(function(e){var t=document.getElementById("imageTag");t.src=URL.createObjectURL(e);var a="test";i._uploadFile(e,a).bind(i)}).catch(function(e){t.show("Error: "+e)})},_tilePressed:function(e){if(e.getSource()&&e.getSource()._oDocument&&e.getSource()._oDocument.DocumentListPath){var t=e.getParameter("action");var a=e.getSource()._oDocument;if(a){var n=t===i._Action.Remove?"DeleteConfirmation":"";if(!this.isImageMimeCode(a.MimeCode)){n=t===i._Action.Press?"OpenDocument":n}var o=new sap.client.evt.EventContext(e.oSource);if(o&&n){o._sImplicitLeadSelectionPath=a.DocumentListPath;o.addParam(sap.client.evt.EventContext.PARAMETERS.ROW_IDENTIFIER.PATH,"/Root/AttachmentFolder/DocumentList");o._oEventArguments[sap.client.evt.EventContext.PARAMETERS.ROW_IDENTIFIER]=a._sNodeId;this._attachedECController.getEventProcessor().handleEvent(n,o)}}}},onBeforeRendering:function(){},onAfterRendering:function(){this._setupThumbnailSize()},_setupImageResize:function(e){if(e&&(this._oRuntimeEnviroment.isRunningInContainer()||this._bAlwaysResize)){switch(e){case"L":this._iCompressedWidthHeight=this.LARGE_WIDTH_HEIGHT;break;case"M":this._iCompressedWidthHeight=this.MEDIUM_WIDTH_HEIGHT;break;case"S":this._iCompressedWidthHeight=this.SMALL_WIDTH_HEIGHT;break;default:this._iCompressedWidthHeight=null}}},_showUploadingDialog:function(){if(!this._oDialog){this._oDialog=new sap.m.Dialog(this.getControlPrefixId()+"-dialog",{title:sap.client.m.Util.getLocaleText("UploadInProgress","Uploading..."),content:new sap.m.Text(this.getControlPrefixId()+"-text",{text:sap.client.m.Util.getLocaleText("FileUploadingMsg","Uploading file to server, please wait ...")})})}this._oDialog.open()},_closeUploadingDialog:function(){if(this._oDialog){this._oDialog.close()}},_onImageResized:function(e,t,i){var a=i;if(e){var n=e.mParameters.files[0];if(n){a=n.name}}if(this._oApplication.isOfflineMode()){var o=this._dataUriToBlob(t);this._uploadFile(o,a)}else{this._uploadFile(t,a)}},_dataUriToBlob:function(e){var t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),n=a.length,o=new Uint8Array(n);while(n--){o[n]=a.charCodeAt(n)}return new Blob([o],{type:i})},_uploadFile:function(e,t){var i=new window.FileTransfer;if(this._oApplication.isOfflineMode()){i=this.getOfflineFileTransfer()}var a=this._oRuntimeEnviroment;var n=a.isRunningInContainer();var o=new window.FileUploadOptions;var s;if(t){s=t}else if(e.name){s=e.name}else{s="file"}o.fileName=s;o.fileKey="file";o.chunkedMode=false;if(typeof e==="string"&&e.match("image.*")){o.mimeType="image/png"}else if(typeof e==="string"&&e.match("data:.*")){o.mimeType=e.split(";")[0].split(":")[1]}else{o.mimeType=e.type}o.headers={Referer:window.location.href};this._showUploadingDialog();var r=this.getUploadURL();var l=this.onFileUploadSuccess.bind(this);var h=this.onFileUploadFail.bind(this);i.upload(e,r,l,h,o)},_onFileChange:function(e){var t;if(this._oApplication.isOfflineMode()){t=this._oApplication.getFileTransfer();this._showUploadingDialog();var i=e.mParameters.files[0];var a={fileKey:"file",fileName:i.name,mimeType:i.type};var n=this.onFileUploadSuccess.bind(this);var o=this.onFileUploadFail.bind(this);t.upload(i,null,n,o,a)}else{t=e.oSource;var s=this.getUploadURL();t.setUploadUrl(s);var r=this.oController.getImageProcessor();if(r){if(this.isImageFileUploader(t)){r.openPreview(s,e)}else{t.upload();r.closePreview(s,e)}}else{this._showUploadingDialog();t.upload()}}},isImageFileUploader:function(e){if(e&&e.oFileUpload){var t=e.oFileUpload.files[0];return this.isImageFile(t)}return false},isImageFile:function(e){if(e&&e.type&&e.type.match("image.*")||e&&e.mimeType&&e.mimeType.match("image.*")){return true}return false},isImageMimeCode:function(e){if(e.match("image.*")){return true}return false},_getIconFromFilename:function(e){var t=this._splitFilename(e).extension;if(jQuery.type(t)==="string"){t=t.toLowerCase()}switch(t){case".bmp":case".jpg":case".jpeg":case".png":return"sap-icon://card";case".csv":case".xls":case".xlsx":return"sap-icon://excel-attachment";case".doc":case".docx":case".odt":return"sap-icon://doc-attachment";case".pdf":return"sap-icon://pdf-attachment";case".ppt":case".pptx":return"sap-icon://ppt-attachment";case".txt":return"sap-icon://document-text";default:return"sap-icon://document"}},_splitFilename:function(e){var t={};var i=e.split(".");if(i.length===1){t.extension="";t.name=i.pop();return t}t.extension="."+i.pop();t.name=i.join(".");return t},getOfflineFileTransfer:function(){if(!this.oOfflineFileTransfer){var e=sap.ui.requireSync("sap/client/setup/offline/FileTransfer");var t=this._oApplication.getOfflineAPI();this.oOfflineFileTransfer=new e(t)}return this.oOfflineFileTransfer},setControlWidth:function(e){if(this.oControl.setWidth){this.oControl.setWidth("100%")}},getUploadURL:function(){var e;var t=this._oApplication.getRepositoryUrl();if(t){e=t.indexOf("/sap/")+4;if(e>=0){var i=this.oController.getSession().getSessionID();t=t.substr(0,e)+"("+i+")"+t.substr(e)}}if(t){e=t.lastIndexOf("/");if(e>=0){t=t.substr(0,e)+"/fileupload"}}return t},uploadComplete:function(e,t,i){if(!this._getAttachedECController()){return}var a=this._primaryPath;if(e!==null&&t!==null&&i!==null){var n=this._attachedECController.getDataContainer();n.setProperty(a+"/content","id="+e,this.getBindingContext());n.setProperty(a+"/fileName",t,this.getBindingContext());n.setProperty(a+"/fileSize",i,this.getBindingContext());n.checkUpdate(a+"/fileName.FormattedValue");if(this.oFileUploader.oFilePath){this.oFileUploader.oFilePath.setValue(t)}}var o;if(this.oFileUploader){o=new sap.client.evt.EventContext(this.oFileUploader)}this._onFileSelected=this.___checkAndCreateEH(this._onFileSelected);var s=this._onFileSelected;if(s){this._attachedECController.getEventProcessor().handleEvent(s,o)}this.oFileUploader.setTooltip(t)},onFileUploadSuccess:function(e){var t=null;var i=null;var a=null;var n=unescape(decodeURI(e.response));n=n.replace(/[\r]/g,"");var o=n.split("\n");if(o.length===3){t=o[0].split("=")[1];i=o[1].split("=")[1];a=o[2].split("=")[1]}this._closeUploadingDialog();this.uploadComplete(t,i,a)},onFileUploadFail:function(e){this._closeUploadingDialog();var t;if(e.exception){t=e.exception}else{t=e.message}this._resetUploader();sap.m.MessageToast.show(sap.client.m.Util.getLocaleText("FileUploadFailMsg","Unable to upload file. ")+" "+t);jQuery.sap.log.info("onFileUploadFail exception "+t)},onTakePictureSuccess:function(e){if(this.oImageResizer){var t=function(t){var i;if(e.startsWith("/")){i="image-"+(new Date).getTime()+".jpg"}else{i=e.replace(/^.*[\\\/]/,"")}this._onImageResized(null,t,i)};var i=function(e){sap.m.MessageToast.show(sap.client.m.Util.getLocaleText("FileUploadFailMsg","Unable to upload file. ")+" "+sap.client.m.Util.getLocaleText("FileUploadImageResizeFailMsg","Failed to resize image"))};if(this._oApplication.isOfflineMode()&&window.FilePicker){var a="data:image/jpeg;base64,"+e;this.oImageResizer.resizeImage(a).then(t.bind(this),i)}else{this.oImageResizer.resizeImagePath(e).then(t.bind(this),i)}}else{var n=this._oApplication.getFileTransfer();var o=new window.FileUploadOptions;var s;if(e.startsWith("/")){o.content=e;o.fileName=(new Date).getTime()+".jpg";s=o.fileName}else{o.fileName=e.replace(/^.*[\\\/]/,"");s=e}o.fileKey="file";o.mimeType="image/jpeg";o.chunkedMode=false;o.headers={Referer:window.location.href};this._showUploadingDialog();var r=this.getUploadURL();var l=this.onFileUploadSuccess.bind(this);var h=this.onFileUploadFail.bind(this);n.upload(s,r,l,h,o)}},onTakePictureFail:function(e){jQuery.sap.log.info("onTakePictureFail for error "+e)},onPictureButtonPress:function(e){if(navigator.camera){var t=navigator.camera.DestinationType.FILE_URI;var i=45;if(this._oApplication.isOfflineMode()&&window.FilePicker){i=10;t=navigator.camera.DestinationType.DATA_URL}var a={quality:i,targetWidth:1024,targetHeight:768,saveToPhotoAlbum:false,destinationType:t};navigator.camera.getPicture(this.onTakePictureSuccess.bind(this),this.onTakePictureFail.bind(this),a)}},_resetUploader:function(){if(!this._getAttachedECController()){return}var e=this._primaryPath;var t=this._attachedECController.getDataContainer();t.setProperty(e+"/content",null,this.getBindingContext());t.setProperty(e+"/fileName",null,this.getBindingContext());t.setProperty(e+"/fileSize",null,this.getBindingContext());if(this.oFileUploader.oFilePath){this.oFileUploader.oFilePath.setValue("")}t.setProperty("/Root/$System/EditMode",false);t.setProperty("/Root/$System/IsThingDirty",false)},___checkAndCreateEH:function(e){var t="ZCEH";var i=e;if(e.length==0||e.lastIndexOf(t,0)==0){return i}if(!this._getAttachedECController()){return i}this._attachedECController.getComponentModel().getEventHandlers();var a=this._attachedECController.getComponentModel().getEventHandler(e);if(a){var n=a._c.findIndex(function(e){return e._n=="WindowAction"&&e._a.action=="Close"});if(n==-1){}else{var o=JSON.parse(JSON.stringify(a));o._a.id=a._a.id.substring(0,a._a.id.length-4)+t;o._c.splice(n,1);i=t+"_"+e;this._attachedECController.getComponentModel()._mEventHandlers[i]=o}}return i}});return g},true);
sap.ui.predefine("zcustom/frasers/ui5lib/control/ZFeederEnhancementPane",["sap/client/basecontrols/core/CustomPane"],function(e){"use strict";var t=e.extend("zcustom.frasers.ui5lib.control.ZFeederEnhancementPane",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{},events:{}},renderer:function(e,t){jQuery.sap.log.debug(">> renderer","","zCustomPane");if(!t.getVisible()){return}e.write("<div");e.writeControlData(t);e.addClass("sapClientCodSeodFeeder");e.write("</div>")},initializePane:function(){jQuery.sap.log.debug(">> initializePane","","zCustomPane");var e=this;this._initializeControls();this.getModel().attachDataContainerUpdateFinished(function(){e._onDataContainerUpdateFinished()})},aControls:[],fFromUser:false,fToAccount:false,fToVendor:false,fToAgent:false,sUserEmail:"",oCurrentFeeder:null,_getControls:function(e){jQuery.sap.log.debug(">> _getControls","","zCustomPane");var t=this;if(!this.aControls[e]){var o={};o.oFromUser=new sap.ui.commons.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",checked:true,change:function(e){t._onFromUserChange(e.mParameters.checked)}});o.oFromUser.addStyleClass("outlookBox");o.oToAccount=new sap.ui.commons.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",checked:false,change:function(e){t._onToAccountChange(e.mParameters.checked)}});o.oToAccount.addStyleClass("outlookBox");o.oToVendor=new sap.ui.commons.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",checked:true,change:function(e){t._onToVendorChange(e.mParameters.checked)}});o.oToVendor.addStyleClass("outlookBox");o.oToAgent=new sap.ui.commons.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",checked:false,change:function(e){t._onToAgentChange(e.mParameters.checked)}});o.oToAgent.addStyleClass("outlookBox");o.oRecipientLayout=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[o.oToAccount,o.oToVendor,o.oToAgent]});this.aControls.splice(e,0,o)}return this.aControls[e]},_initializeControls:function(){jQuery.sap.log.debug(">> _initializeControls","","zCustomPane");var e=this;this.aControls=[];this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._onRecipientChange();this._onFromUserChange(this.fFromUser)},onBeforeRendering:function(){jQuery.sap.log.debug(">> onBeforeRendering","","zCustomPane")},onAfterRendering:function(){jQuery.sap.log.debug(">> onAfterRendering","","zCustomPane");var e=this;this.aControls=[];this._onDataContainerUpdateFinished();var t=false;var o=0;var n=null;var a=this.getController().getParentController()._oCurrentComponentModel._mNodeNames.CustomPane;for(var r=0;r<a.length;r++){var s=a[r];if(s._a&&s._a.jsTypeName&&s._a.jsTypeName.indexOf("Feeder")>=0){t=true;break}}if(t){var i=0;if(this.oCurrentFeeder){try{i=parseInt(this.oCurrentFeeder.sId.replace("__feeder",""),10)}catch(e){i=0}}else{i=0}var l=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MAX_VALUE;var u=null;for(r=i;r<=l;r++){var c="__feeder"+r;u=sap.ui.getCore().byId(c);if(u){if(u.oReplyLayout){n=u}}else{if(n){break}else{continue}}}if(n&&n.oReplyLayout){n.oReplyLayout.addContent(this._getNewLayout(o));n.addEventDelegate({onAfterRendering:function(t){e.oCurrentFeeder=t.srcControl}});o++;this.oCurrentFeeder=n;if(this.oCurrentFeeder.oOutlookScoped){this.oCurrentFeeder.oOutlookScoped.setChecked(false)}}}if(this.oCurrentFeeder){var h=this.oCurrentFeeder;var g=this.oCurrentFeeder.cancelButtonPress;this.oCurrentFeeder.cancelButtonPress=function(){h.bIsReply=false;g.apply(h)};if(h.oEmailSendButton){h.oEmailSendButton.attachPress(function(){h.bIsReply=false})}}var d=this.getController().getParentController().getDataContainer().getDataObject("/Root/zFeederRelevant/ToList");if(d){d.attachValueChanged(function(){var t=e._getValue("Root/zFeederRelevant/ReplyEmail");var o=e._getValue("/Root/zFeederRelevant/ToList");if(t){if(t!==o){e._onRecipientChange()}}else if(o!==e.sTo){e._onRecipientChange()}})}d=this.getController().getParentController().getDataContainer().getDataObject("/Root/zFeederRelevant/NewToEmail");if(d){d.attachValueChanged(function(){var t=e._getValue("Root/zFeederRelevant/ReplyEmail");var o=e._getValue("/Root/zFeederRelevant/NewToEmail");if(t){if(t!==o){e._onRecipientChange()}}else if(o!==e.sTo){e._onRecipientChange()}})}},_getNewLayout:function(e){jQuery.sap.log.debug(">> _getNewLayout","","zCustomPane");var t=this._getControls(e);var o=null;if(t){o=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[t.oFromUser,t.oRecipientLayout]})}return o},_onDataContainerUpdateFinished:function(){jQuery.sap.log.debug(">> _onDataContainerUpdateFinished","","zCustomPane");this._onRecipientChange();this._onFromUserChange(this.fFromUser)},_onFromUserChange:function(e){jQuery.sap.log.debug(">> _onFromUserChange");try{if(this.fFromUser!==e||!this.sUserEmail){this.fFromUser=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oFromUser.getChecked()!==e){this.aControls[t].oFromUser.setChecked(e)}}if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}else{this._setFromField("")}}}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_onToAccountChange:function(e){jQuery.sap.log.debug(">> _onToAccountChange","","zCustomPane");if(this.fToAccount!==e){this.fToAccount=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAccount.getChecked()!==e){this.aControls[t].oToAccount.setChecked(e)}}this._onRecipientChange()}},_onToVendorChange:function(e){jQuery.sap.log.debug(">> _onToVendorChange","","zCustomPane");if(this.fToVendor!==e){this.fToVendor=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToVendor.getChecked()!==e){this.aControls[t].oToVendor.setChecked(e)}}this._onRecipientChange()}},_onToAgentChange:function(e){jQuery.sap.log.debug(">> _onToAgentChange","","zCustomPane");if(this.fToAgent!==e){this.fToAgent=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAgent.getChecked()!==e){this.aControls[t].oToAgent.setChecked(e)}}this._onRecipientChange()}},_onRecipientChange:function(){jQuery.sap.log.debug(">> _onRecipientChange","","zCustomPane");if(this.oCurrentFeeder){if(this.oCurrentFeeder.bComposeNewEmail||this.oCurrentFeeder.bIsReply){return}}try{var e="; ";var t=this._getValue("/Root/ZAccountEmail");var o=this._getValue("/Root/ZVendorEmail");var n=this._getValue("/Root/ZAgentEmail");this.sTo=this._getValue("/Root/zFeederRelevant/ToList");this.sTo="";if(this.fToAccount&&t){this.sTo=this.sTo.concat(t).concat(e)}if(this.fToVendor&&o){this.sTo=this.sTo.concat(o).concat(e)}if(this.fToAgent&&n){this.sTo=this.sTo.concat(n).concat(e)}this._setValue("/Root/zFeederRelevant/ToList",this.sTo);this._setValue("/Root/zFeederRelevant/NewToEmail",this.sTo)}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_setFromField:function(e){jQuery.sap.log.debug(">> _setFromField","","zCustomPane");try{this._setValue("/Root/zFeederRelevant/SelectedSMAPEmail",e)}catch(e){jQuery.sap.log.debug("Error in _setFromField: "+e.message)}},_getUserEmail:function(){jQuery.sap.log.debug(">> _getUserEmail","","zCustomPane");var e="";try{e=this._getValue("/Root/ZCurrentUserEmail")}catch(e){jQuery.sap.log.debug("Error in _getUserEmail: "+e.message)}return e},_setValue:function(e,t){jQuery.sap.log.debug(">> _setValue","","zCustomPane");var o=this.getController();while(o){var n=o.getDataContainer();if(n&&n.getDataObject(e)){n.getDataObject(e).setValue(t);break}o=o.getParentController()}},_getValue:function(e){jQuery.sap.log.debug(">> _getValue","","zCustomPane");var t="";var o=this.getController();while(o){var n=o.getDataContainer();if(n&&n.getDataObject(e)){t=n.getDataObject(e).getValue();break}o=o.getParentController()}return t}});return t},true);
sap.ui.predefine("zcustom/frasers/ui5lib/control/ZFeederEnhancementPaneV2",["sap/client/basecontrols/core/CustomPane"],function(e){"use strict";var t=e.extend("zcustom.frasers.ui5lib.control.ZFeederEnhancementPaneV2",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{},events:{}},renderer:function(e,t){jQuery.sap.log.debug(">> renderer","","zCustomPane")},initializePane:function(){jQuery.sap.log.debug(">> initializePane","","zCustomPane");var e=this;this._initParameters();if(sap.client.getCurrentApplication().isNewUI()){var t=this._fetchFeederECController(this._feederECName);if(t){this._onChildControllerAdded()}this.getController().getParentController().attachEvent("ChildControllerAdded",this,this._onChildControllerAdded,this)}else{this._initializeControls()}this.getModel().attachDataContainerUpdateFinished(function(){e._onDataContainerUpdateFinished()})},_initParameters:function(){this._feederECName="";this._sToPath="";this._sToPathOutlook="";this._sFromPath="";if(sap.client.getCurrentApplication().isNewUI()){this._feederECName="COD_Interactions_EC";this._sToPath="/Root/Feeder/Email/ToList";this._sToPathOutlook="";this._sFromPath="/Root/Feeder/Email/From";this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._bIsReply=false;this._loadFirstTime=true}else{this._sToPath="/Root/zFeederRelevant/ToList";this._sToPathOutlook="/Root/zFeederRelevant/NewToEmail";this._sFromPath="/Root/zFeederRelevant/SelectedSMAPEmail"}},_onChildControllerAdded:function(e){try{if(e.oSource._aChildController.length>0){var t=e.oSource._aChildController[e.oSource._aChildController.length-1].getEmbeddingContext()._a.embedName;if(t.indexOf(this._feederECName)!==-1){this._fetchFeederECController(t)}}}catch(e){return}},_enhanceInlineResponse:function(){if(this._oInlineResponse&&this._oInlineResponse._inlineResponseLayout){this._oInlineResponse._inlineResponseLayout.addContent(this._getNewLayoutRUI());this._oInlineResponse.invalidate();this._onRecipientChange();if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}}},_onECInterActionFinished:function(e){if(sap.client.getCurrentApplication().isNewUI()){try{var t=e.getSource().getEmbeddingContext()._a.embedName;var o=this.getController().getParentController().getChildController(t);var s=o.getBaseControl().getContent()[0].getContent()}catch(e){return}try{if(!this._oInlineResponse||s&&s instanceof sap.client.cod.seod.RUIResponse.InlineResponse&&this._oInlineResponse.getId()!==s.getId()){if(this._oInlineResponse&&s&&s instanceof sap.client.cod.seod.RUIResponse.InlineResponse&&this._oInlineResponse.getId()!==s.getId()){this._loadFirstTime=true}this._oInlineResponse=s;if(this._loadFirstTime){this._loadFirstTime=false;this._oInlineResponse.getController().getEventProcessor().attachEvent(sap.client.evt.EventProcessor.EVENTS.EVENT_FIRED,this._eventCallback,this);this._oToDataObject=o.getDataContainer().getDataObject(this._sToPath);this._oFromDataObject=o.getDataContainer().getDataObject(this._sFromPath);this._oURIDataObject=o.getDataContainer().getDataObject("/Root/Feeder/Email/EmailURI");if(this._oFromDataObject){this._oFromDataObject.attachValueChanged(function(e){this.sUserEmail=this._getUserEmail();if(this.fFromUser&&e.getParameter("value")!==this.sUserEmail){this._setFromField(this.sUserEmail)}}.bind(this))}if(this._oURIDataObject){this._oURIDataObject.attachValueChanged(function(e){this._composeEmailURI()}.bind(this))}}if(!this._oInlineResponse._inlineResponseLayout){if(this._oInlineResponse._initializeInlineControl.getFormattedValue()==true){this.wait4InlineResponse=true}else{this._oInlineResponse._inlineResponseLayout=new sap.ui.layout.VerticalLayout;this._oInlineResponse._inlineResponseLayout.addStyleClass("ruiResponseInlineResponseLayout")}}if(this._oInlineResponse._inlineResponseLayout){this._enhanceInlineResponse()}}}catch(e){jQuery.sap.log.debug("Error in _onECInterActionFinished: "+e.message)}}},_fetchFeederECController:function(e){try{var t=this.getController().getParentController().getChildController(e);if(t){t.attachEvent("ECInterActionFinished",this,this._onECInterActionFinished,this)}}catch(e){t=undefined}return t},aControls:[],fFromUser:false,fToAccount:false,fToVendor:false,fToAgent:false,sUserEmail:"",oCurrentFeeder:null,newButtonPressed:false,wait4InlineResponse:false,_eventCallback:function(e){switch(e.getParameter("event")){case"InlineResponse_Initialize":if(this.wait4InlineResponse){this._enhanceInlineResponse();this.wait4InlineResponse=false}break;case"CIP_New_Button":case"CIP_NewMail_Outlook":this.newButtonPressed=true;break;case"Reply_To_Latest_Interaction":case"Reply_To_Selected_Interaction":this._bIsReply=true;break;case"Reply_with_outlook":case"ReplyTo_Interaction_with_outlook":this._bIsReply=true;break;case"Forward_Selected_Interaction":break;case"Feeder_ValueChange":if(this.newButtonPressed){this._onRecipientChange();this._composeEmailURI();this.newButtonPressed=false}break}},_getControls:function(e){jQuery.sap.log.debug(">> _getControls","","zCustomPane");var t=this;if(!this.aControls[e]){var o={};o.oFromUser=new sap.ui.commons.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",checked:true,change:function(e){t._onFromUserChange(e.mParameters.checked)}});o.oFromUser.addStyleClass("outlookBox");o.oToAccount=new sap.ui.commons.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",checked:false,change:function(e){t._onToAccountChange(e.mParameters.checked)}});o.oToAccount.addStyleClass("outlookBox");o.oToVendor=new sap.ui.commons.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",checked:true,change:function(e){t._onToVendorChange(e.mParameters.checked)}});o.oToVendor.addStyleClass("outlookBox");o.oToAgent=new sap.ui.commons.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",checked:false,change:function(e){t._onToAgentChange(e.mParameters.checked)}});o.oToAgent.addStyleClass("outlookBox");o.oRecipientLayout=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[o.oToAccount,o.oToVendor,o.oToAgent]});this.aControls.splice(e,0,o)}return this.aControls[e]},_getControlsRUI:function(){jQuery.sap.log.debug(">> _getControlsRUI","","zCustomPane");var e={};e.oFromUser=new sap.m.CheckBox({text:"Use user’s email as sender",tooltip:"Use user’s email as sender",selected:this.fFromUser,select:function(e){this._onFromUserChange(e.getParameter("selected"))}.bind(this)});e.oToAccount=new sap.m.CheckBox({text:"Use Account’s email as recipient",tooltip:"Use Account’s email as recipient",selected:this.fToAccount,select:function(e){this._onToAccountChange(e.getParameter("selected"))}.bind(this)});e.oToVendor=new sap.m.CheckBox({text:"Use Partner’s email as recipient",tooltip:"Use Partner’s email as recipient",selected:this.fToVendor,select:function(e){this._onToVendorChange(e.getParameter("selected"))}.bind(this)});e.oToAgent=new sap.m.CheckBox({text:"Use Agent’s email as recipient",tooltip:"Use Agent’s email as recipient",selected:this.fToAgent,select:function(e){this._onToAgentChange(e.getParameter("selected"))}.bind(this)});e.oRecipientLayout=new sap.ui.layout.HorizontalLayout({width:"100%",content:[e.oToAccount,e.oToVendor,e.oToAgent]});return e},_initializeControls:function(){jQuery.sap.log.debug(">> _initializeControls","","zCustomPane");this.aControls=[];this.fFromUser=true;this.fToAccount=false;this.fToVendor=true;this.fToAgent=false;this._onRecipientChange();this._onFromUserChange(this.fFromUser)},onBeforeRendering:function(){jQuery.sap.log.debug(">> onBeforeRendering","","zCustomPane")},onAfterRendering:function(){jQuery.sap.log.debug(">> onAfterRendering","","zCustomPane");var e=this;this.aControls=[];this._onDataContainerUpdateFinished();var t=false;var o=0;var s=null;var n=this.getController().getParentController()._oCurrentComponentModel._mNodeNames.CustomPane;for(var i=0;i<n.length;i++){var a=n[i];if(a._a&&a._a.jsTypeName&&a._a.jsTypeName.indexOf("Feeder")>=0){t=true;break}}if(t){var r=0;if(this.oCurrentFeeder){try{r=parseInt(this.oCurrentFeeder.sId.replace("__feeder",""),10)}catch(e){r=0}}else{r=0}var l=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MAX_VALUE;var h=null;for(i=r;i<=l;i++){var c="__feeder"+i;h=sap.ui.getCore().byId(c);if(h){if(h.oReplyLayout){s=h}}else{if(s){break}else{continue}}}if(s&&s.oReplyLayout){s.oReplyLayout.addContent(this._getNewLayout(o));s.addEventDelegate({onAfterRendering:function(t){e.oCurrentFeeder=t.srcControl}});o++;this.oCurrentFeeder=s;if(this.oCurrentFeeder.oOutlookScoped){this.oCurrentFeeder.oOutlookScoped.setChecked(false)}}}if(this.oCurrentFeeder){var u=this.oCurrentFeeder;var d=this.oCurrentFeeder.cancelButtonPress;this.oCurrentFeeder.cancelButtonPress=function(){u.bIsReply=false;d.apply(u)};if(u.oEmailSendButton){u.oEmailSendButton.attachPress(function(){u.bIsReply=false})}}if(!sap.client.getCurrentApplication().isNewUI()){this._oToDataObject=this.getController().getParentController().getDataContainer().getDataObject(this._sToPath);if(this._oToDataObject){this._oToDataObject.attachValueChanged(function(){var e=this._getValue("/Root/zFeederRelevant/ReplyEmail");var t=this._oToDataObject.getValue();if(e){if(e!==t){this._onRecipientChange()}}else if(t!==this.sTo){this._onRecipientChange()}}.bind(this))}if(this._sToPathOutlook){var g=this.getController().getParentController().getDataContainer().getDataObject(this._sToPathOutlook);if(g){g.attachValueChanged(function(){var e=this._getValue("/Root/zFeederRelevant/ReplyEmail");var t=this._getValue(this._sToPathOutlook);if(e){if(e!==t){this._onRecipientChange()}}else if(t!==this.sTo){this._onRecipientChange()}}.bind(this))}}}},_getNewLayout:function(e){jQuery.sap.log.debug(">> _getNewLayout","","zCustomPane");var t=this._getControls(e);var o=null;if(t){o=new sap.ui.commons.layout.VerticalLayout({width:"100%",content:[t.oFromUser,t.oRecipientLayout]})}return o},_getNewLayoutRUI:function(){jQuery.sap.log.debug(">> _getNewLayoutRUI","","zCustomPane");var e=this._getControlsRUI();var t=null;if(e){t=new sap.ui.layout.VerticalLayout({width:"100%",content:[e.oFromUser,e.oRecipientLayout]})}return t},_onDataContainerUpdateFinished:function(){jQuery.sap.log.debug(">> _onDataContainerUpdateFinished","","zCustomPane");this._onRecipientChange();this._onFromUserChange(this.fFromUser)},_onFromUserChange:function(e){jQuery.sap.log.debug(">> _onFromUserChange");try{if(this.fFromUser!==e||!this.sUserEmail){this.fFromUser=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oFromUser.getChecked()!==e){this.aControls[t].oFromUser.setChecked(e)}}if(this.fFromUser){this.sUserEmail=this._getUserEmail();this._setFromField(this.sUserEmail)}else{this._setFromField("")}}}catch(e){jQuery.sap.log.debug("Error in _onFromUserChange: "+e.message)}},_onToAccountChange:function(e){jQuery.sap.log.debug(">> _onToAccountChange","","zCustomPane");if(this.fToAccount!==e){this.fToAccount=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAccount.getChecked()!==e){this.aControls[t].oToAccount.setChecked(e)}}this._onRecipientChange()}},_onToVendorChange:function(e){jQuery.sap.log.debug(">> _onToVendorChange","","zCustomPane");if(this.fToVendor!==e){this.fToVendor=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToVendor.getChecked()!==e){this.aControls[t].oToVendor.setChecked(e)}}this._onRecipientChange()}},_onToAgentChange:function(e){jQuery.sap.log.debug(">> _onToAgentChange","","zCustomPane");if(this.fToAgent!==e){this.fToAgent=e;for(var t=0;t<this.aControls.length;t++){if(this.aControls[t]&&this.aControls[t].oToAgent.getChecked()!==e){this.aControls[t].oToAgent.setChecked(e)}}this._onRecipientChange()}},_set_sTo:function(){try{var e=", ";var t=this._getValue("/Root/ZAccountEmail");var o=this._getValue("/Root/ZVendorEmail");var s=this._getValue("/Root/ZAgentEmail");if(this._oToDataObject){this.sTo=this._oToDataObject.getValue();this.sTo="";if(this.fToAccount&&t){this.sTo=this.sTo===""?t:this.sTo.concat(e).concat(t)}if(this.fToVendor&&o){this.sTo=this.sTo===""?o:this.sTo.concat(e).concat(o)}if(this.fToAgent&&s){this.sTo=this.sTo===""?s:this.sTo.concat(e).concat(s)}}}catch(e){jQuery.sap.log.debug("Error in _set_sTo: "+e.message)}},_onRecipientChange:function(){jQuery.sap.log.debug(">> _onRecipientChange","","zCustomPane");if(this.oCurrentFeeder){if(this.oCurrentFeeder.bComposeNewEmail||this.oCurrentFeeder.bIsReply){return}}try{if(this._oToDataObject){this._set_sTo();this._oToDataObject.setValue(this.sTo);if(this._sToPathOutlook){this._setValue(this._sToPathOutlook,this.sTo)}}}catch(e){jQuery.sap.log.debug("Error in _onRecipientChange: "+e.message)}},_composeEmailURI:function(){if(!this._bIsReply){try{var e=this._oURIDataObject.getValue();if(e){var t=e.split("mailto:")[1];var o=t.split("?Subject=")[0];var s=t.split("?Subject=")[1];this._set_sTo();if(o!==this.sTo){e="mailto:".concat(this.sTo.concat("?Subject=".concat(s)));this._oURIDataObject.setValue(e)}}}catch(e){}}else{this._bIsReply=false}},_setFromField:function(e){jQuery.sap.log.debug(">> _setFromField","","zCustomPane");try{if(this._oFromDataObject){this._oFromDataObject.setValue(e)}else{this._setValue(this._sFromPath,e)}}catch(e){jQuery.sap.log.debug("Error in _setFromField: "+e.message)}},_getUserEmail:function(){jQuery.sap.log.debug(">> _getUserEmail","","zCustomPane");var e="";try{e=this._getValue("/Root/ZCurrentUserEmail")}catch(e){jQuery.sap.log.debug("Error in _getUserEmail: "+e.message)}return e},_setValue:function(e,t){jQuery.sap.log.debug(">> _setValue","","zCustomPane");var o=this.getController();while(o){var s=o.getDataContainer();if(s&&s.getDataObject(e)){s.getDataObject(e).setValue(t);break}o=o.getParentController()}},_getValue:function(e){jQuery.sap.log.debug(">> _getValue","","zCustomPane");var t="";var o=this.getController();while(o){var s=o.getDataContainer();if(s&&s.getDataObject(e)){t=s.getDataObject(e).getValue();break}o=o.getParentController()}return t}});return t},true);
sap.ui.predefine("zcustom/frasers/ui5lib/control/ZPoCCustomPane",["sap/client/basecontrols/core/CustomPane","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,r){"use strict";var n=e.extend("zcustom.frasers.ui5lib.control.ZPoCCustomPane",{metadata:{library:"zcustom.frasers.ui5lib",properties:{},aggregations:{_btn:{type:"sap.m.Button",multiple:false,visibility:"hidden"}},events:{}},renderer:function(e,t){jQuery.sap.log.debug(">> renderer");if(!t.getVisible()){return}e.write("<span");e.writeControlData(t);e.write(">");e.renderControl(t.getAggregation("_btn"));e.write("</span>")},initializePane:function(){jQuery.sap.log.debug(">> initializePane");var e=this;this.btn=new sap.m.Button({width:"100%",text:"Test",press:jQuery.proxy(this._onButtonPressed,this)});this.setAggregation("_btn",this.btn)},onBeforeRendering:function(){jQuery.sap.log.debug(">> onBeforeRendering");var e=this},onAfterRendering:function(){jQuery.sap.log.debug(">> onAfterRendering");var e=this},_onButtonPressed:function(){jQuery.sap.log.debug(">> _onButtonPressed");try{this.getController().getParentController().getDataContainer().getDataObject("/Root/zFeederRelevant/SelectedSMAPEmail").setValue("vishneuski@gmail.com")}catch(e){jQuery.sap.log.error("Error in _onButtonPressed: ",e.message,"zcustom")}}});return n},true);
sap.ui.predefine("zcustom/frasers/ui5lib/ext/ZImage",["sap/m/library","sap/m/Image","sap/m/ImageRenderer"],function(e,r,i){"use strict";var t=e.ImageMode;var a=r.extend("zcustom.frasers.ui5lib.ext.ZImage",{metadata:{library:"zcustom.frasers.ui5lib"},renderer:function(e,r){i.render(e,r)}});a.prototype.onAfterRendering=function(){var e=this.$(),r=this.getMode(),i;if(this.getDetailBox()){e=this.$().children("img").first()}if(r===t.Image){e.on("load",jQuery.proxy(this.onload,this));e.on("error",jQuery.proxy(this.onerror,this));i=e[0]}if(r===t.Background){i=this._oImage}if(i&&i.complete&&!this._defaultEventTriggered){if(i.naturalWidth>0){this.onload({})}else{this.onerror({})}}};return a});
sap.ui.predefine("zcustom/frasers/ui5lib/ext/ZThumbnailTile",["sap/m/GenericTile","zcustom/frasers/ui5lib/ext/ZThumbnailTileRenderer","sap/m/library"],function(e,t,i){"use strict";var r=e.extend("zcustom.frasers.ui5lib.ext.ZThumbnailTile",{metadata:{library:"zcustom.frasers.ui5lib"},renderer:function(e,i){t.render(e,i)}});r.prototype._isHeaderTextTruncated=function(){var e,t,r,n;if(this.getMode()===i.GenericTileMode.LineMode){r=this.$("hdr-text");if(r.length>0){n=Math.ceil(r[0].getBoundingClientRect().width);return r[0]&&n<r[0].scrollWidth}else{return false}}else{e=this.getAggregation("_titleText").getDomRef("inner");if(e){t=this.getAggregation("_titleText").getClampHeight(e);return t<e.scrollHeight}else{return false}}};return r});
sap.ui.predefine("zcustom/frasers/ui5lib/ext/ZThumbnailTileContent",["sap/m/TileContent","zcustom/frasers/ui5lib/ext/ZThumbnailTileContentRenderer"],function(e,t){"use strict";var r=e.extend("zcustom.frasers.ui5lib.ext.ZThumbnailTileContent",{metadata:{library:"zcustom.frasers.ui5lib"},renderer:function(e,r){t.render(e,r)}});return r});
sap.ui.predefine("zcustom/frasers/ui5lib/ext/ZThumbnailTileContentRenderer",["sap/m/library","jquery.sap.global","sap/m/TileContentRenderer","sap/ui/core/Renderer"],function(e,t,r,n){"use strict";var i=n.extend(r);i.render=function(e,r){var n=r.getTooltip_AsString();var i=r._getContentType();if(i){i=t.sap.encodeCSS(i)}var a=t.sap.encodeCSS("sapMFrameType"+r.getFrameType());e.write("<div");e.writeControlData(r);e.addClass("ZsapMTileCnt");e.addClass(i);e.addClass(a);if(n.trim()){e.writeAttributeEscaped("title",n)}e.writeClasses();e.write(">");this._renderContent(e,r);if(r.getFooter()){this._super._renderFooter(e,r)}e.write("</div>")};i._renderContent=function(e,t){if(!t._bRenderContent){return}var r=t.getContent();if(r){e.write("<div");e.writeClasses();e.writeAttribute("id",t.getId()+"-content");e.write(">");if(!r.hasStyleClass("sapMTcInnerMarker")){r.addStyleClass("sapMTcInnerMarker")}e.renderControl(r);e.write("</div>")}};return i},true);
sap.ui.predefine("zcustom/frasers/ui5lib/ext/ZThumbnailTileRenderer",["sap/m/library","jquery.sap.global","sap/m/GenericTileRenderer","sap/ui/core/Renderer"],function(e,t,r,a){"use strict";var i=e.GenericTileMode;var s=e.GenericTileScope;var d=e.LoadState;var n=a.extend(r);n.render=function(e,r){var a=r._getTooltipText();var n=r._getAriaText();var o=r.getHeaderImage();var l=r.hasListeners("press");var p=r.getState();var c=r.getScope();var u=t.sap.encodeCSS("sapMGTState"+p);var g=t.sap.encodeCSS("sapMGTScope"+c);e.write("<div");e.writeControlData(r);if(a){e.writeAttributeEscaped("title",a)}e.addClass("sapMGT");e.addClass(u);e.addClass(g);if(c!==s.Actions&&r._bShowActionsView){e.addClass("sapMGTScopeActions")}e.addClass(r.getFrameType());if(l){e.writeAttribute("role","button")}else{e.writeAttribute("role","presentation")}e.writeAttributeEscaped("aria-label",n);if(p!==d.Disabled){e.addClass("sapMPointer");e.writeAttribute("tabindex","0")}if(r.getBackgroundImage()){e.write(" style='background-image:url(");e.writeEscaped(r.getBackgroundImage());e.write(");'");e.addClass("sapMGTBackgroundImage")}if(r.getMode()===i.HeaderMode){e.addClass("sapMGTHeaderMode")}e.writeClasses();e.write(">");if(r.getHeader()){e.write("<div");e.addClass("sapMGTHdrContent");e.addClass(r.getFrameType());if(a){e.writeAttributeEscaped("title",a)}e.writeClasses();e.write(">");if(o){e.renderControl(r._oImage)}this._super._renderHeader(e,r);if(r.getSubheader()){this._super._renderSubheader(e,r)}e.write("</div>")}e.write("<div");if(r.getHeader()){e.addClass("sapMGTContent")}else{e.addClass("ZsapMGTContent")}e.writeClasses();e.writeAttribute("id",r.getId()+"-content");e.write(">");var v=r.getTileContent();var w=v.length;for(var C=0;C<w;C++){r._checkFooter(v[C],r);e.renderControl(v[C])}e.write("</div>");if(p!==d.Loaded){this._super._renderStateOverlay(e,r,a)}if(p!==d.Disabled){this._super._renderHoverOverlay(e,r);this._super._renderFocusDiv(e,r)}if(c===s.Actions){this._renderActionsScope(e,r)}e.write("</div>")};n._renderActionsScope=function(e,t){if(t.getState()!==d.Disabled){e.renderControl(t._oRemoveButton)}};return n},true);
/*!
 * ${copyright}
 */
sap.ui.predefine("zcustom/frasers/ui5lib/library",["jquery.sap.global","sap/ui/core/library"],function(e,r){"use strict";sap.ui.getCore().initLibrary({name:"zcustom.frasers.ui5lib",dependencies:[],types:[],interfaces:[],controls:["zcustom.frasers.ui5lib.control.ZPoCCustomPane","zcustom.frasers.ui5lib.control.ZFeederEnhancementPane","zcustom.frasers.ui5lib.control.ZFeederEnhancementPaneV2","zcustom.frasers.ui5lib.control.ZAttachmentsPane","zcustom.frasers.ui5lib.ext.ZThumbnailTile","zcustom.frasers.ui5lib.ext.ZThumbnailTileRenderer","zcustom.frasers.ui5lib.ext.ZThumbnailTileContent","zcustom.frasers.ui5lib.ext.ZThumbnailTileContentRenderer","zcustom.frasers.ui5lib.ext.ZImage"],elements:[],noLibraryCSS:true,version:"1.1.0"});return zcustom.frasers.ui5lib});
jQuery.sap.registerPreloadedModules({
"version":"2.0",
"modules":{
	"zcustom/frasers/ui5lib/manifest.json":'{"_version":"1.1.0","sap.app":{"id":"zcustom.frasers.ui5lib","type":"library","applicationVersion":{"version":"0.1.0"},"title":"{{lib.title}}","description":"{{lib.descr}}","openSourceComponents":[],"resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","deviceTypes":{"desktop":true,"tablet":true,"phone":true},"supportedThemes":["base","sap_hcb","sap_belize","sap_belize_plus"]},"sap.ui5":{"resources":{"js":[],"css":[]},"dependencies":{"minUI5Version":"1.40.0","libs":{"sap.ui.core":{},"sap.m":{},"sap.ui.unified":{"lazy":true},"sap.client.cod.newui.shared":{"minVersion":""}}},"contentDensities":{"compact":true,"cozy":true}}}'
}});
